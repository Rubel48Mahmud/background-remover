
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro AI Background Editor</title>
    
    <!-- Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #4CAF50;
            --accent: #FF6584;
            --bg: #F7F9FC;
            --card: #FFFFFF;
            --text: #2D3436;
            --border: #E0E0E0;
            --shadow: 0 8px 30px rgba(0,0,0,0.08);
            --radius: 20px;
        }

        [data-theme="dark"] {
            --primary: #8C85FF;
            --bg: #1A1A2E;
            --card: #16213E;
            --text: #E0E0E0;
            --border: #2F3452;
            --shadow: 0 8px 30px rgba(0,0,0,0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; transition: all 0.3s ease; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            border-bottom: 1px solid var(--border);
        }
        [data-theme="dark"] header { background: rgba(22, 33, 62, 0.8); }

        .brand { font-size: 20px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .icon-btn { background: none; border: none; font-size: 22px; color: var(--text); cursor: pointer; padding: 5px; }

        /* Sidebar */
        .sidebar {
            position: fixed; left: -280px; top: 0; width: 280px; height: 100%;
            background: var(--card); z-index: 200; padding: 80px 20px 20px;
            box-shadow: 5px 0 25px rgba(0,0,0,0.1);
        }
        .sidebar.active { left: 0; }
        .sidebar-item {
            padding: 15px; border-radius: 12px; display: flex; align-items: center; gap: 15px;
            cursor: pointer; margin-bottom: 10px; color: var(--text); font-weight: 500;
        }
        .sidebar-item:hover { background: rgba(108, 99, 255, 0.1); color: var(--primary); }
        .sidebar-item i { width: 25px; }
        
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 150; }
        .overlay.active { display: block; }

        /* Main Container */
        .container { max-width: 500px; margin: 30px auto; padding: 0 20px 80px; }

        /* Upload Area */
        .upload-box {
            background: var(--card);
            border: 2px dashed var(--primary);
            border-radius: var(--radius);
            padding: 50px 20px;
            text-align: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            group: hover;
        }
        .upload-box:hover { transform: translateY(-3px); box-shadow: var(--shadow); }
        .upload-icon-wrapper {
            width: 80px; height: 80px; background: rgba(108, 99, 255, 0.1);
            border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;
        }
        .upload-icon-wrapper i { font-size: 35px; color: var(--primary); }
        .upload-box h3 { font-size: 18px; margin-bottom: 5px; }
        .upload-box p { font-size: 13px; color: #888; }
        .hidden-input { display: none; }

        /* Image Cards */
        .card {
            background: var(--card); border-radius: var(--radius); padding: 20px;
            margin-top: 25px; box-shadow: var(--shadow); text-align: center; display: none;
        }
        .card-img {
            max-width: 100%; border-radius: 12px; margin-bottom: 15px;
            background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px; background-color: #fff;
        }

        /* Buttons */
        .btn {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--secondary); color: white; margin-top: 10px; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); margin-top: 10px; }
        
        /* Editor Section */
        .editor-controls {
            margin-top: 15px;
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px;
            justify-content: center; align-items: center;
        }
        
        .color-dot {
            width: 35px; height: 35px; border-radius: 50%; border: 2px solid rgba(0,0,0,0.1); cursor: pointer;
            flex-shrink: 0;
            position: relative;
        }
        .color-dot.active { border: 2px solid var(--text); transform: scale(1.15); }
        
        /* Rainbow Color Picker Wrapper */
        .color-picker-wrapper {
            background: conic-gradient(red, yellow, lime, aqua, blue, magenta, red);
            display: flex; align-items: center; justify-content: center;
        }
        /* Invisible Native Input covering the rainbow circle */
        .color-picker-input {
            opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;
        }

        .bg-upload-btn {
            width: 35px; height: 35px; border-radius: 50%; background: #eee;
            display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #ccc;
            flex-shrink: 0;
        }

        /* Canvas (Hidden but used for generation) */
        canvas { display: none; }
        
        /* Loading Animation */
        .loader-box { display: none; margin: 20px 0; }
        .progress-bar { width: 100%; height: 8px; background: #ddd; border-radius: 5px; overflow: hidden; }
        .progress { height: 100%; background: var(--primary); width: 0%; border-radius: 5px; }

    </style>
</head>
<body>

    <div class="overlay" onclick="toggleMenu()"></div>

    <!-- Sidebar Menu -->
    <nav class="sidebar" id="sidebar">
        <div style="text-align: right;">
            <button class="icon-btn" onclick="toggleMenu()"><i class="fas fa-times"></i></button>
        </div>
        <div class="sidebar-item" onclick="location.reload()">
            <i class="fas fa-home"></i> Home
        </div>
        <div class="sidebar-item" onclick="showHistory()">
            <i class="fas fa-history"></i> History
        </div>
        <div class="sidebar-item" onclick="toggleTheme()">
            <i class="fas fa-moon"></i> Dark Mode
        </div>
        <div class="sidebar-item" onclick="showAbout()">
            <i class="fas fa-info-circle"></i> About App
        </div>
    </nav>

    <!-- Header (Icon removed from right side) -->
    <header>
        <button class="icon-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
        <div class="brand"><i class="fas fa-wand-magic-sparkles"></i> EditPro</div>
        <div style="width: 24px;"></div> <!-- Spacer to balance layout -->
    </header>

    <div class="container">
        <!-- Step 1: Upload -->
        <label for="fileInput" class="upload-box" id="drop-area">
            <div class="upload-icon-wrapper">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <h3>Upload Photo</h3>
            <p>Tap here or drag & drop image</p>
            <input type="file" id="fileInput" class="hidden-input" accept="image/*">
        </label>

        <!-- Loading Bar -->
        <div class="loader-box" id="loader">
            <p style="margin-bottom:5px; font-size:14px;">Removing Background...</p>
            <div class="progress-bar"><div class="progress" id="progress"></div></div>
        </div>

        <!-- Step 2: Result & Editor -->
        <div class="card" id="result-card">
            <!-- This image element shows the preview -->
            <img id="preview-img" class="card-img" src="" alt="Result">
            
            <!-- Hidden Canvas for merging layers -->
            <canvas id="editor-canvas"></canvas>

            <!-- Editor Tools (Visible only after remove) -->
            <div id="editor-tools" style="display:none; margin-top: 15px;">
                <p style="font-size:14px; margin-bottom:8px; font-weight:600;">Choose Background</p>
                
                <div class="editor-controls">
                    <!-- Transparent (Default) -->
                    <div class="color-dot active" title="Transparent" style="background: url('https://i.ibb.co/fd8gKgK/background-removed-2.png'); background-size: cover;" onclick="changeBg(null, this)"></div>
                    
                    <!-- Presets -->
                    <div class="color-dot" title="White" style="background: #ffffff;" onclick="changeBg('#ffffff', this)"></div>
                    <div class="color-dot" title="Black" style="background: #000000;" onclick="changeBg('#000000', this)"></div>
                    <div class="color-dot" title="Blue" style="background: #3498db;" onclick="changeBg('#3498db', this)"></div>
                    <div class="color-dot" title="Yellow" style="background: #f1c40f;" onclick="changeBg('#f1c40f', this)"></div>
                    <div class="color-dot" title="Red" style="background: #e74c3c;" onclick="changeBg('#e74c3c', this)"></div>
                    
                    <!-- Unlimited Color Picker -->
                    <div class="color-dot color-picker-wrapper" title="Pick Any Color">
                        <input type="color" id="customColorPicker" class="color-picker-input">
                    </div>

                    <!-- Upload Custom BG -->
                    <label for="bgInput" class="bg-upload-btn" title="Upload Image">
                        <i class="fas fa-image" style="font-size: 14px; color:#555"></i>
                    </label>
                    <input type="file" id="bgInput" class="hidden-input" accept="image/*">
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="margin-top: 20px;">
                <button class="btn btn-outline" id="edit-btn" onclick="toggleEditor()">
                    <i class="fas fa-palette"></i> Edit Background
                </button>
                <button class="btn btn-success" id="download-btn" onclick="downloadImage()">
                    <i class="fas fa-download"></i> Download HD
                </button>
                <button class="btn btn-primary" onclick="location.reload()" style="margin-top:10px; background:#FF6584;">
                    <i class="fas fa-trash"></i> Reset
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Variables ---
        const apiKey = "L86gznS3FLPJaJZazRxrR9cH"; // Your API Key
        const fileInput = document.getElementById('fileInput');
        const bgInput = document.getElementById('bgInput');
        const customColorPicker = document.getElementById('customColorPicker');
        const loader = document.getElementById('loader');
        const progressBar = document.getElementById('progress');
        const resultCard = document.getElementById('result-card');
        const previewImg = document.getElementById('preview-img');
        const canvas = document.getElementById('editor-canvas');
        const ctx = canvas.getContext('2d');
        const editBtn = document.getElementById('edit-btn');
        const editorTools = document.getElementById('editor-tools');
        
        let foregroundImgObj = new Image(); 
        let currentBgType = 'transparent'; // transparent, color, image
        let currentBgValue = null; 

        // --- Event Listeners ---
        
        // 1. Main Image Upload
        fileInput.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if(!file) return;

            document.querySelector('.upload-box').style.display = 'none';
            loader.style.display = 'block';
            
            let width = 0;
            const interval = setInterval(() => {
                if(width >= 90) clearInterval(interval);
                else { width += 5; progressBar.style.width = width + '%'; }
            }, 200);

            const formData = new FormData();
            formData.append("image_file", file);
            formData.append("size", "auto");

            try {
                const response = await fetch("https://api.remove.bg/v1.0/removebg", {
                    method: "POST",
                    headers: { "X-Api-Key": apiKey },
                    body: formData
                });

                if(!response.ok) throw new Error("API Limit Reached or Network Error");

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                
                foregroundImgObj.onload = () => {
                    canvas.width = foregroundImgObj.width;
                    canvas.height = foregroundImgObj.height;
                    drawCanvas(); 
                };
                foregroundImgObj.src = url;

                clearInterval(interval);
                progressBar.style.width = '100%';
                setTimeout(() => {
                    loader.style.display = 'none';
                    resultCard.style.display = 'block';
                }, 500);

            } catch (error) {
                Swal.fire("Error", error.message, "error");
                document.querySelector('.upload-box').style.display = 'block';
                loader.style.display = 'none';
            }
        });

        // 2. Custom Background Image Upload
        bgInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        currentBgType = 'image';
                        currentBgValue = img;
                        drawCanvas(); 
                        document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                    };
                    img.src = event.target.result;
                }
                reader.readAsDataURL(file);
            }
        });

        // 3. Custom Color Picker (Input Event)
        customColorPicker.addEventListener('input', function(e) {
            const color = e.target.value;
            
            // Remove active from others, add to parent of input
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
            e.target.parentElement.classList.add('active');

            currentBgType = 'color';
            currentBgValue = color;
            drawCanvas();
        });

        // --- Functions ---

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.querySelector('.overlay').classList.toggle('active');
        }

        function toggleEditor() {
            if(editorTools.style.display === 'none') {
                editorTools.style.display = 'block';
                editBtn.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Editor';
            } else {
                editorTools.style.display = 'none';
                editBtn.innerHTML = '<i class="fas fa-palette"></i> Edit Background';
            }
        }

        function changeBg(color, element) {
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
            element.classList.add('active');

            if(color === null) {
                currentBgType = 'transparent';
            } else {
                currentBgType = 'color';
                currentBgValue = color;
            }
            drawCanvas();
        }

        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (currentBgType === 'color') {
                ctx.fillStyle = currentBgValue;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            } 
            else if (currentBgType === 'image' && currentBgValue) {
                ctx.drawImage(currentBgValue, 0, 0, canvas.width, canvas.height);
            }

            ctx.drawImage(foregroundImgObj, 0, 0);
            previewImg.src = canvas.toDataURL("image/png");
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'edited-image.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
        }

        function toggleTheme() {
            const body = document.body;
            if(body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
            } else {
                body.setAttribute('data-theme', 'dark');
            }
            // Close menu if open on mobile
            if(document.getElementById('sidebar').classList.contains('active')){
                toggleMenu();
            }
        }

        function showHistory() {
            toggleMenu();
            Swal.fire({
                title: "History",
                text: "No previous edits found in this session.",
                icon: "info"
            });
        }

        function showAbout() {
            toggleMenu();
            Swal.fire({
                title: "About EditPro",
                html: "Version 2.1<br>Designed by <b>Rubel Mahmud</b><br><br>Features:<br>- Unlimited Color Picker<br>- Custom Background<br>- Dark Mode",
                confirmButtonColor: '#6C63FF'
            });
        }

    </script>
</body>
</html>
